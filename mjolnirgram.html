<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
        rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
        />
        <title>draw a line map</title>
        <style>
            /* Set the size of the div element that contains the map */
            #map {
                width: 100%;
                height: 96vh;
                position: relative;
                transform: translateZ(0px);
                border-radius: 5px;
            }
            
            #color-palette {
                clear: both;
            }
            
            input {
                text-align: right;
                padding: 10px;
            }
            
            .color-button {
                width: 30px;
                height: 30px;
                font-size: 0;
                margin: 2px;
                float: left;
                cursor: pointer;
                border-radius: 16px;
            }
            
            .button_style {
                border-radius: 20px;
            }
            
            .input_radius {
                border-bottom-right-radius: 20px;
                border-top-right-radius: 20px;
            }
            
            .input_radius_icon {
                border-bottom-left-radius: 20px;
                border-top-left-radius: 20px;
            }
            
            .padding_less {
                padding-left: 0px;
            }
            
            .margin_container {
                margin-top: 15px;
                margin-bottom: 15px;
            }
            
            .text-align_div {
                margin-left: auto;
                margin-right: auto;
                height: 40px;
                margin-top: 15px;
                width: 300px;
                background-color: white;
                padding: 2px;
                border-radius: 5px;
            }
            
            .pair-align_div {
                margin-left: auto;
                margin-right: auto;
                height: 100px;
                margin-top: 15px;
                width: 300px;
                background-color: white;
                padding: 2px;
                border-radius: 5px;
                padding: 15px;
            }
            
            #area,
            #tiles {
                font-weight: bold;
                text-align: center;
            }
            
            .btn-info {
                box-shadow: 0 4px 2px -2px #555;
            }
            .disclaimer {
                display: none !important;
            }
            .form {
                width: 350px;
                height: 375px;
                border: 1px solid #ccc;
                margin-left: 14px;
                border-radius: 5px;
                background: #cccccc94;
                margin-top: 10px;
                position: absolute;
                top: 12px;
                left: 12px;
            }
            .color-icons {
                margin-top: 10px;
                margin-bottom: 10px;
            }
            .colors {
                display: flex;
                justify-content: center;
            }
            .input-row {
                margin-top: 18px;
                display: flex;
                justify-content: center;
            }
            .inner-div {
                max-width: 330px;
                margin-right: auto;
                margin-left: auto;
            }
            .current-area-tiles {
                display: flex;
                flex-direction: column;
            }
        </style>
        <style>
            .contextmenu {
                display: none;
                background: #eee;
                color: #000;
                position: fixed;
                left: 20px;
                top: 20px;
                min-width: 200px;
                list-style: none;
                margin: 0;
                padding: 0;
                border: 1px solid rgb(68 68 68 / 23%);
                z-index: 999;
            }
            .contextmenu.open {
                display: block;
            }
            .contextmenu-link {
                display: block;
                padding: 10px;
                text-decoration: none !important;
                color: #000 ;
            }
            .submenu {
                position: relative;
            }
            .submenu::after {
                content: "";
                width: 0;
                height: 0;
                border: 4px solid #000;
                border-top-color: transparent;
                border-left-color: transparent;
                transform: translate(-50%, -50%) rotate(-45deg);
                position: absolute;
                right: 5px;
                top: 50%;
            }
            .submenu-content {
                position: absolute;
                left: 100%;
                top: 0;
                width: 100%;
                background: #eee;
                border: 1px solid rgb(68 68 68 / 23%);
                display: none;
                list-style: none;
                padding: 0;
            }
            .submenu:hover > .submenu-content {
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid margin_container">
            <div class="row">
                <div class="col-sm-12 col-md-12">
                    <div id="map"></div>
                </div>
            </div>
        </div>
        
        <div class="form" id="overlay-section">
            <div class="inner-div">
                <div class="row m-0 input-row">
                    <div class="">
                        <div class="input-group">
                            <span class="input-group-addon input_radius_icon"
                                ><i class="glyphicon glyphicon-search"></i
                                ></span>
                            <input
                            id="address"
                            type="text"
                            class="form-control input_radius"
                            placeholder="Enter your address"
                            />
                        </div>
                    </div>
                    <div class="padding_less">
                        <button
                            type="button"
                            class="btn btn-info button_style"
                            id="search_byaddress"
                            >
                            Search
                        </button>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 color-icons">
                    <div id="color-palette" class="colors"></div>
                </div>
                <div class="col-sm-12 col-md-12">
                    <button
                        type="button"
                        class="btn btn-info button_style"
                        id="delete-button"
                        >
                        Delete Selected Shape
                    </button>
                    <button
                        type="button"
                        class="btn btn-info button_style"
                        id="calculate"
                        >
                        Calculate Area
                    </button>
                </div>
                <div class="row current-area-tiles">
                    <div class="col-sm-12 col-md-12 text-align_div">
                        <h4 id="area">Current Area = 0.00 ft²</h4>
                    </div>
                    <div class="col-sm-12 col-md-12 text-align_div">
                        <h4 id="tiles">Current Tiles = 0</h4>
                    </div>
                    <div class="col-sm-12 col-md-12 pair-align_div">
                        <div
                            style="
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
       "
       >
       <div>
           Separation:
           <input
           type="checkbox"
           id="separation_checkbox"
           />
       </div>
       <div>
           Pair rows:
           <input type="checkbox" id="pair_checkbox" />
       </div>
                        </div>
                        <div class="text-center">
                            <button
                                class="btn btn-info btn-sm button_style"
                                onclick="handleOnClickApplyChanges()"
                                >
                                Apply
                            </button>
                        </div>
                        
                        <div>
                            <label style="color: brown">Map:</label>
                            <select id="dropdownone" onchange="changeMap()">
                                <option id="disabledselectedone">- map select -</option>
                                <option id="btnToggleredone">SATELLITE</option>
                                <option id="btnToggleblueone">ROADMAP</option>
                                <option id="btnToggleredone">HYBRID</option>
                                <option id="btnToggleblueone">TERRAIN</option>
                            </select>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <script>
            ///////////////////////////////////////////////////////
            
            var separateCheckoutElement = document.getElementById(
                                                                  "separation_checkbox"
                                                                  );
                                                                  var pairCheckoutElement = document.getElementById("pair_checkbox");
                                                                  var callInterval = null;
                                                                  function handleOnClickApplyChanges() {
                                                                      if (selectedShape) {
                                                                          selectedShape.tiles.forEach(function (box, i) {
                                                                              box.setMap(null);
                                                                              delete box;
                                                                          });
                                                                          onPolygonComplete(selectedShape);
                                                                      }
                                                                  }
            
            var map;
            var polygonOriginalLabel;
            var drawingManager;
            var selectedShape;
            var colors = [
                          "#1E90FF",
                          "#FF1493",
                          "#32CD32",
                          "#FF8C00",
                          "#4B0082",
                          ];
                          var selectedColor;
                          var colorButtons = {};
                          
                          function clearSelection() {
                              if (selectedShape) {
                                  selectedShape.setEditable(false);
                                  selectedShape = null;
                              }
                          }
            
            function setSelection_without_area(shape) {
                clearSelection();
                selectedShape = shape;
                shape.setEditable(true);
                selectColor(shape.get("fillColor") || shape.get("strokeColor"));
            }
            
            function setSelection(shape) {
                clearSelection();
                selectedShape = shape;
                shape.setEditable(true);
                selectColor(shape.get("fillColor") || shape.get("strokeColor"));
                // google.maps.event.addListener(shape.getPath(), 'set_at', calcar);
                // google.maps.event.addListener(shape.getPath(), 'insert_at', calcar);
                tilescount(selectedShape);
                calcar(selectedShape);
            }
            
            function tilescount(newShape1) {
                if (newShape1) {
                    if (newShape1.tiles.length > 0) {
                        var tilesCount = newShape1.tiles.filter(function (el) {
                            return !el.space;
                        });
                        document.getElementById("tiles").innerHTML =
                        "Current Tiles = " + tilesCount.length;
                    }
                }
            }
            
            function calcar(newShape1) {
                var area = google.maps.geometry.spherical.computeArea(
                                                                      newShape1.getPath()
                                                                      );
                                                                      var sqare_feett = area * 10.764;
                                                                      document.getElementById("area").innerHTML =
                                                                      "Current Area = " + sqare_feett.toFixed(2) + " ft²";
            }
            
            function deleteSelectedShape() {
                selectedShape.polygonOriginalLabel.close();
                if (selectedShape) {
                    selectedShape.setMap(null);
                }
                selectedShape.tiles.forEach(function (box, i) {
                    box.setMap(null);
                    delete box;
                });
                document.getElementById("tiles").innerHTML =
                "Current Tiles = " + 0;
                document.getElementById("area").innerHTML =
                "Current Area = 0.00 ft²";
            }
            
            function selectColor(color) {
                selectedColor = color;
                for (var i = 0; i < colors.length; ++i) {
                    var currColor = colors[i];
                    colorButtons[currColor].style.border =
                    currColor == color
                    ? "2px solid #789"
                    : "2px solid #fff";
                }
                
                // Retrieves the current options from the drawing manager and replaces the
                // stroke or fill color as appropriate.
                
                var polygonOptions = drawingManager.get("polygonOptions");
                polygonOptions.fillColor = color;
                drawingManager.set("polygonOptions", polygonOptions);
                
                if (selectedShape) {
                    if (selectedShape.tiles.length > 0) {
                        selectedShape.tiles.forEach(function (box, i) {
                            box.set("fillColor", color);
                        });
                    }
                }
            }
            
            function setSelectedShapeColor(color) {
                if (selectedShape) {
                    if (
                        selectedShape.type ==
                        google.maps.drawing.OverlayType.POLYLINE
                        ) {
                            selectedShape.set("strokeColor", color);
                        } else {
                            selectedShape.set("fillColor", color);
                        }
                }
            }
            
            function makeColorButton(color) {
                var button = document.createElement("span");
                button.className = "color-button";
                button.style.backgroundColor = color;
                // var selected_map = document.getElementById('map')
                button.addEventListener("click", function () {
                    selectColor(color);
                    setSelectedShapeColor(color);
                });
                
                return button;
            }
            
            function buildColorPalette() {
                var colorPalette = document.getElementById("color-palette");
                colorPalette.innerHTML = "";
                for (var i = 0; i < colors.length; ++i) {
                    var currColor = colors[i];
                    var colorButton = makeColorButton(currColor);
                    colorPalette.appendChild(colorButton);
                    colorButtons[currColor] = colorButton;
                }
                selectColor(colors[0]);
            }
            
            function onPolygonComplete(polygon) {
                var bounds,
                paths,
                sw,
                ne,
                ystep,
                xstep,
                boxH,
                boxW,
                posArry,
                flag,
                pos,
                x,
                y,
                i,
                box;
                
                //Calculate the bounds that contains entire polygon.
                bounds = new google.maps.LatLngBounds();
                paths = polygon.getPath();
                paths.forEach(function (latlng, i) {
                    bounds.extend(latlng);
                });
                
                var projection = map.getProjection();
                var zoom = map.getZoom();
                var powBase = Math.pow(2, zoom);
                
                //Calculate the small box size.
                sw = bounds.getSouthWest();
                ne = bounds.getNorthEast();
                var swPoint = projection.fromLatLngToPoint(sw);
                var nePoint = projection.fromLatLngToPoint(ne);
                
                var metersPx =
                (156543.03392 * Math.cos((swPoint.x * Math.PI) / 180)) /
                                         Math.pow(2, zoom);
                                         var pixelPerMeter = 1 / metersPx;
                                         var boxSize = new google.maps.Size(
                                                                            pixelPerMeter * 1.1,
                                                                            pixelPerMeter * 2.25
                                                                            ); //in pixels.
                                         boxSize.width /= powBase;
                                         boxSize.height /= powBase;
                                         
                                         var maxX = Math.floor(
                                                               Math.abs(swPoint.x - nePoint.x) / boxSize.width
                                                               );
                                         var maxY = Math.floor(
                                                               Math.abs(swPoint.y - nePoint.y) / boxSize.height
                                                               );
                                         
                                         if (polygon.tiles) {
                    if (polygon.tiles.length > 0) {
                        polygon.tiles.forEach(function (box, i) {
                            box.setMap(null);
                            delete box;
                        });
                    }
                }
                                         
                                         var tileBoxes = [];
                                         if (maxY < 0 && maxX < 0) {
                    if (separateCheckoutElement.checked) {
                        let separationRow = maxY * 2;
                        maxY = separationRow;
                    }
                    
                    if (pairCheckoutElement.checked) {
                        let pairSeparationRow = maxY + maxY / 2;
                        maxY = pairSeparationRow;
                    }
                    
                    let flagIndex = 1;
                    for (y = maxY; y < 0; ) {
                        flagIndex++;
                        for (x = maxX; x < 0; x++) {
                            //Detect that polygon is able to contain a small box.
                            bounds = new google.maps.LatLngBounds();
                            posArry = [];
                            posArry.push(
                                         new google.maps.Point(
                                                               swPoint.x + boxSize.width * x,
                                                               swPoint.y - boxSize.height * y
                                                               )
                                         );
                                         posArry.push(
                                                      new google.maps.Point(
                                                                            swPoint.x + boxSize.width * x,
                                                                            swPoint.y - boxSize.height * (y + 1)
                                                                            )
                                                      );
                                                      posArry.push(
                                                                   new google.maps.Point(
                                                                                         swPoint.x + boxSize.width * (x + 1),
                                                                                         swPoint.y - boxSize.height * y
                                                                                         )
                                                                   );
                                                                   posArry.push(
                                                                                new google.maps.Point(
                                                                                                      swPoint.x + boxSize.width * (x + 1),
                                                                                                      swPoint.y - boxSize.height * (y + 1)
                                                                                                      )
                                                                                );
                                                                                
                                                                                var flag = true;
                                                                                for (var i = 0; i < posArry.length; i++) {
                                                                                    pos = projection.fromPointToLatLng(posArry[i]);
                                                                                    if (flag) {
                                                                                        flag =
                                                                                        google.maps.geometry.poly.containsLocation(
                                                                                                                                   pos,
                                                                                                                                   polygon
                                                                                                                                   );
                                                                                                                                   bounds.extend(pos);
                                                                                    }
                                                                                }
                                                                                if (flag) {
                                                                                    box = new google.maps.Rectangle({
                                                                                        bounds: bounds,
                                                                                        map: map,
                                                                                        strokeColor: "black",
                                                                                        strokeOpacity: 0.5,
                                                                                        strokeWeight: 0.8,
                                                                                        fillColor: selectedColor,
                                                                                        fillOpacity: 0.5,
                                                                                        clickable: false,
                                                                                    });
                                                                                    tileBoxes.push(box);
                                                                                }
                        }
                        if (
                            separateCheckoutElement.checked &&
                            pairCheckoutElement.checked
                            ) {
                                if (flagIndex % 2 === 0) {
                                    y = y + 1.24;
                                } else {
                                    y++;
                                }
                            } else if (
                                       !separateCheckoutElement.checked &&
                                       pairCheckoutElement.checked
                                       ) {
                                           if (flagIndex % 2 === 0) {
                                               y = y + 1.24;
                                           } else {
                                               y++;
                                           }
                                       } else if (
                                                  separateCheckoutElement.checked &&
                                                  !pairCheckoutElement.checked
                                                  ) {
                                                      y = y + 1.24;
                                                  } else {
                                                      y++;
                                                  }
                    }
                } else if (maxY < 0 && maxX > 0) {
                    if (separateCheckoutElement.checked) {
                        let separationRow = maxY * 2;
                        maxY = separationRow;
                    }
                    
                    if (pairCheckoutElement.checked) {
                        let pairSeparationRow = maxY + maxY / 2;
                        maxY = pairSeparationRow;
                    }
                    let flagIndex = 1;
                    for (y = maxY; y < 0; ) {
                        flagIndex++;
                        for (x = 0; x < maxX; x++) {
                            //Detect that polygon is able to contain a small box.
                            bounds = new google.maps.LatLngBounds();
                            posArry = [];
                            posArry.push(
                                         new google.maps.Point(
                                                               swPoint.x + boxSize.width * x,
                                                               swPoint.y - boxSize.height * y
                                                               )
                                         );
                                         posArry.push(
                                                      new google.maps.Point(
                                                                            swPoint.x + boxSize.width * x,
                                                                            swPoint.y - boxSize.height * (y + 1)
                                                                            )
                                                      );
                                                      posArry.push(
                                                                   new google.maps.Point(
                                                                                         swPoint.x + boxSize.width * (x + 1),
                                                                                         swPoint.y - boxSize.height * y
                                                                                         )
                                                                   );
                                                                   posArry.push(
                                                                                new google.maps.Point(
                                                                                                      swPoint.x + boxSize.width * (x + 1),
                                                                                                      swPoint.y - boxSize.height * (y + 1)
                                                                                                      )
                                                                                );
                                                                                
                                                                                var flag = true;
                                                                                for (var i = 0; i < posArry.length; i++) {
                                                                                    pos = projection.fromPointToLatLng(posArry[i]);
                                                                                    if (flag) {
                                                                                        flag =
                                                                                        google.maps.geometry.poly.containsLocation(
                                                                                                                                   pos,
                                                                                                                                   polygon
                                                                                                                                   );
                                                                                                                                   bounds.extend(pos);
                                                                                    }
                                                                                }
                                                                                if (flag) {
                                                                                    box = new google.maps.Rectangle({
                                                                                        bounds: bounds,
                                                                                        map: map,
                                                                                        strokeColor: "black",
                                                                                        strokeOpacity: 0.5,
                                                                                        strokeWeight: 0.8,
                                                                                        fillColor: selectedColor,
                                                                                        fillOpacity: 0.5,
                                                                                        clickable: false,
                                                                                    });
                                                                                    tileBoxes.push(box);
                                                                                }
                        }
                        if (
                            separateCheckoutElement.checked &&
                            pairCheckoutElement.checked
                            ) {
                                if (flagIndex % 2 === 0) {
                                    y = y + 1.24;
                                } else {
                                    y++;
                                }
                            } else if (
                                       !separateCheckoutElement.checked &&
                                       pairCheckoutElement.checked
                                       ) {
                                           if (flagIndex % 2 === 0) {
                                               y = y + 1.24;
                                           } else {
                                               y++;
                                           }
                                       } else if (
                                                  separateCheckoutElement.checked &&
                                                  !pairCheckoutElement.checked
                                                  ) {
                                                      y = y + 1.24;
                                                  } else {
                                                      y++;
                                                  }
                    }
                } else if (maxY > 0 && maxX < 0) {
                    if (separateCheckoutElement.checked) {
                        let separationRow = maxY * 2;
                        maxY = separationRow;
                    }
                    
                    if (pairCheckoutElement.checked) {
                        let pairSeparationRow = maxY + maxY / 2;
                        maxY = pairSeparationRow;
                    }
                    let flagIndex = 1;
                    for (y = 0; y < maxY; ) {
                        flagIndex++;
                        for (x = maxX; x < 0; x++) {
                            //Detect that polygon is able to contain a small box.
                            bounds = new google.maps.LatLngBounds();
                            posArry = [];
                            posArry.push(
                                         new google.maps.Point(
                                                               swPoint.x + boxSize.width * x,
                                                               swPoint.y - boxSize.height * y
                                                               )
                                         );
                                         posArry.push(
                                                      new google.maps.Point(
                                                                            swPoint.x + boxSize.width * x,
                                                                            swPoint.y - boxSize.height * (y + 1)
                                                                            )
                                                      );
                                                      posArry.push(
                                                                   new google.maps.Point(
                                                                                         swPoint.x + boxSize.width * (x + 1),
                                                                                         swPoint.y - boxSize.height * y
                                                                                         )
                                                                   );
                                                                   posArry.push(
                                                                                new google.maps.Point(
                                                                                                      swPoint.x + boxSize.width * (x + 1),
                                                                                                      swPoint.y - boxSize.height * (y + 1)
                                                                                                      )
                                                                                );
                                                                                
                                                                                var flag = true;
                                                                                for (var i = 0; i < posArry.length; i++) {
                                                                                    pos = projection.fromPointToLatLng(posArry[i]);
                                                                                    if (flag) {
                                                                                        flag =
                                                                                        google.maps.geometry.poly.containsLocation(
                                                                                                                                   pos,
                                                                                                                                   polygon
                                                                                                                                   );
                                                                                                                                   bounds.extend(pos);
                                                                                    }
                                                                                }
                                                                                if (flag) {
                                                                                    box = new google.maps.Rectangle({
                                                                                        bounds: bounds,
                                                                                        map: map,
                                                                                        strokeColor: "black",
                                                                                        strokeOpacity: 0.5,
                                                                                        strokeWeight: 0.8,
                                                                                        fillColor: selectedColor,
                                                                                        fillOpacity: 0.5,
                                                                                        clickable: false,
                                                                                    });
                                                                                    tileBoxes.push(box);
                                                                                }
                        }
                        if (
                            separateCheckoutElement.checked &&
                            pairCheckoutElement.checked
                            ) {
                                if (flagIndex % 2 === 0) {
                                    y = y + 1.24;
                                } else {
                                    y++;
                                }
                            } else if (
                                       !separateCheckoutElement.checked &&
                                       pairCheckoutElement.checked
                                       ) {
                                           if (flagIndex % 2 === 0) {
                                               y = y + 1.24;
                                           } else {
                                               y++;
                                           }
                                       } else if (
                                                  separateCheckoutElement.checked &&
                                                  !pairCheckoutElement.checked
                                                  ) {
                                                      y = y + 1.24;
                                                  } else {
                                                      y++;
                                                  }
                    }
                } else {
                    alert(4);
                    if (separateCheckoutElement.checked) {
                        let separationRow = maxY * 2;
                        maxY = separationRow;
                    }
                    
                    if (pairCheckoutElement.checked) {
                        let pairSeparationRow = maxY + maxY / 2;
                        maxY = pairSeparationRow;
                    }
                    
                    let flagIndex = 1;
                    for (y = 0; y < maxY; ) {
                        flagIndex++;
                        for (x = 0; x < maxX; x++) {
                            //Detect that polygon is able to contain a small box.
                            bounds = new google.maps.LatLngBounds();
                            posArry = [];
                            posArry.push(
                                         new google.maps.Point(
                                                               swPoint.x + boxSize.width * x,
                                                               swPoint.y - boxSize.height * y
                                                               )
                                         );
                                         posArry.push(
                                                      new google.maps.Point(
                                                                            swPoint.x + boxSize.width * x,
                                                                            swPoint.y - boxSize.height * (y + 1)
                                                                            )
                                                      );
                                                      posArry.push(
                                                                   new google.maps.Point(
                                                                                         swPoint.x + boxSize.width * (x + 1),
                                                                                         swPoint.y - boxSize.height * y
                                                                                         )
                                                                   );
                                                                   posArry.push(
                                                                                new google.maps.Point(
                                                                                                      swPoint.x + boxSize.width * (x + 1),
                                                                                                      swPoint.y - boxSize.height * (y + 1)
                                                                                                      )
                                                                                );
                                                                                
                                                                                var flag = true;
                                                                                for (var i = 0; i < posArry.length; i++) {
                                                                                    pos = projection.fromPointToLatLng(posArry[i]);
                                                                                    if (flag) {
                                                                                        flag =
                                                                                        google.maps.geometry.poly.containsLocation(
                                                                                                                                   pos,
                                                                                                                                   polygon
                                                                                                                                   );
                                                                                                                                   bounds.extend(pos);
                                                                                    }
                                                                                }
                                                                                if (flag) {
                                                                                    box = new google.maps.Rectangle({
                                                                                        bounds: bounds,
                                                                                        map: map,
                                                                                        strokeColor: "black",
                                                                                        strokeOpacity: 0.5,
                                                                                        strokeWeight: 0.8,
                                                                                        fillColor: selectedColor,
                                                                                        fillOpacity: 0.5,
                                                                                        clickable: false,
                                                                                    });
                                                                                    tileBoxes.push(box);
                                                                                }
                        }
                        
                        if (
                            separateCheckoutElement.checked &&
                            pairCheckoutElement.checked
                            ) {
                                if (flagIndex % 2 === 0) {
                                    y = y + 1.24;
                                } else {
                                    y++;
                                }
                            } else if (
                                       !separateCheckoutElement.checked &&
                                       pairCheckoutElement.checked
                                       ) {
                                           if (flagIndex % 2 === 0) {
                                               y = y + 1.24;
                                           } else {
                                               y++;
                                           }
                                       } else if (
                                                  separateCheckoutElement.checked &&
                                                  !pairCheckoutElement.checked
                                                  ) {
                                                      y = y + 1.24;
                                                  } else {
                                                      y++;
                                                  }
                    }
                }
                                         
                                         polygon.tiles = tileBoxes;
                                         }
                                         
                                         function initMap() {
                    var options = {
                        // types: ['(cities)'],
                        // componentRestrictions: {country: "jp"}
                    };
                    
                    var input = document.getElementById("address");
                    var autocompvare = new google.maps.places.Autocomplete(
                                                                           input,
                                                                           options
                                                                           );
                                                                           google.maps.event.addListener(
                                                                                                         autocompvare,
                                                                                                         "place_changed",
                                                                                                         function () {
                                                                                                             var place = autocompvare.getPlace();
                                                                                                             lat_current = place.geometry.location.lat();
                                                                                                             lng_current = place.geometry.location.lng();
                                                                                                         }
                                                                                                         );
                                                                                                         
                                                                                                         map = new google.maps.Map(document.getElementById("map"), {
                                                                                                             zoom: 19,
                                                                                                             center: {
                                                                                                                 lat: 37.09024,
                                                                                                                 lng: -95.712891,
                                                                                                             },
                                                                                                             mapTypeId: "satellite",
                                                                                                             clickableIcons: false,
                                                                                                             disableDefaultUI: true,
                                                                                                             panControl: true,
                                                                                                             zoomControl: true,
                                                                                                             scaleControl: true,
                                                                                                             styles: [
                                                                                                                      {
                                                                                                                          featureType: "poi",
                                                                                                                          stylers: [
                                                                                                                                    {
                                                                                                                                        visibility: "off",
                                                                                                                                    },
                                                                                                                                    ],
                                                                                                                      },
                                                                                                                      {
                                                                                                                          featureType: "poi.business",
                                                                                                                          stylers: [
                                                                                                                                    {
                                                                                                                                        visibility: "off",
                                                                                                                                    },
                                                                                                                                    ],
                                                                                                                      },
                                                                                                                      ],
                                                                                                         });
                                                                                                         drawing_work();
                                                                                                         
                                                                                                         document
                                                                                                         .getElementById("search_byaddress")
                                                                                                         .addEventListener("click", search_byaddress);
                                                                                                         
                                                                                                         function search_byaddress() {
                                                                                                             go_and_do(lat_current, lng_current);
                                                                                                         }
                                                                                                         
                                                                                                         function go_and_do(lat_current, lng_current) {
                                                                                                             var center = {
                                                                                                                 lat: lat_current,
                                                                                                                 lng: lng_current,
                                                                                                             };
                                                                                                             map.setCenter(center);
                                                                                                         }
                                                                                                         
                                                                                                         function drawing_work() {
                                                                                                             var polyOptions = {
                                                                                                                 fillOpacity: 0,
                                                                                                                 editable: true,
                                                                                                             };
                                                                                                             // Creates a drawing manager attached to the map that allows the user to draw
                                                                                                             // markers, lines, and shapes.
                                                                                                             drawingManager = new google.maps.drawing.DrawingManager({
                                                                                                                 drawingMode: google.maps.drawing.OverlayType.POLYGON,
                                                                                                                 markerOptions: {
                                                                                                                     draggable: true,
                                                                                                                 },
                                                                                                                 polylineOptions: {
                                                                                                                     editable: true,
                                                                                                                 },
                                                                                                                 rectangleOptions: polyOptions,
                                                                                                                 circleOptions: polyOptions,
                                                                                                                 polygonOptions: polyOptions,
                                                                                                                 drawingControlOptions: {
                                                                                                                     position: google.maps.ControlPosition.TOP_CENTER,
                                                                                                                     drawingModes: [
                                                                                                                                    google.maps.drawing.OverlayType.POLYGON,
                                                                                                                                    ],
                                                                                                                 },
                                                                                                                 
                                                                                                                 map: map,
                                                                                                             });
                                                                                                             
                                                                                                             let polygonObj = null;
                                                                                                             var proc = function () {
                                                                                                                 onPolygonComplete(polygonObj);
                                                                                                             };
                                                                                                             
                                                                                                             google.maps.event.addListener(
                                                                                                                                           drawingManager,
                                                                                                                                           "overlaycomplete",
                                                                                                                                           function (e) {
                                                                                                                                               if (
                                                                                                                                                   e.type != google.maps.drawing.OverlayType.MARKER
                                                                                                                                                   ) {
                                                                                                                                                       // Switch back to non-drawing mode after drawing a shape.
                                                                                                                                                       drawingManager.setDrawingMode(null);
                                                                                                                                                       
                                                                                                                                                       // Add an event listener that selects the newly-drawn shape when the user
                                                                                                                                                       // mouses down on it.
                                                                                                                                                       var newShape = e.overlay;
                                                                                                                                                       newShape.type = e.type;
                                                                                                                                                       
                                                                                                                                                       google.maps.event.addListener(
                                                                                                                                                                                     newShape,
                                                                                                                                                                                     "click",
                                                                                                                                                                                     function () {
                                                                                                                                                                                         setSelection(newShape);
                                                                                                                                                                                         polygonObj = newShape;
                                                                                                                                                                                         
                                                                                                                                                                                         // updateLabelOfPolygon(newShape);
                                                                                                                                                                                     }
                                                                                                                                                                                     );
                                                                                                                                                                                     
                                                                                                                                                                                     //  document.getElementById('calculate').addEventListener('click', function() {
                                                                                                                                                                                     //     google.maps.event.trigger(newShape, 'click');
                                                                                                                                                                                     // });
                                                                                                                                                                                     polygonObj = newShape;
                                                                                                                                                                                     
                                                                                                                                                                                     addLabelToNewShape(newShape);
                                                                                                                                                                                     
                                                                                                                                                                                     onPolygonComplete(newShape);
                                                                                                                                                                                     setSelection_without_area(newShape);
                                                                                                                                                                                     google.maps.event.addListener(
                                                                                                                                                                                                                   newShape.getPath(),
                                                                                                                                                                                                                   "set_at",
                                                                                                                                                                                                                   proc
                                                                                                                                                                                                                   );
                                                                                                                                                                                                                   google.maps.event.addListener(
                                                                                                                                                                                                                                                 newShape.getPath(),
                                                                                                                                                                                                                                                 "insert_at",
                                                                                                                                                                                                                                                 proc
                                                                                                                                                                                                                                                 );
                                                                                                                                                                                                                                                 google.maps.event.addListener(
                                                                                                                                                                                                                                                                               newShape.getPath(),
                                                                                                                                                                                                                                                                               "remove_at",
                                                                                                                                                                                                                                                                               proc
                                                                                                                                                                                                                                                                               );
                                                                                                                                                   }
                                                                                                                                           }
                                                                                                                                           );
                                                                                                                                           
                                                                                                                                           google.maps.event.addListener(
                                                                                                                                                                         drawingManager,
                                                                                                                                                                         "drawingmode_changed",
                                                                                                                                                                         clearSelection
                                                                                                                                                                         );
                                                                                                                                                                         google.maps.event.addListener(map, "click", clearSelection);
                                                                                                                                                                         document
                                                                                                                                                                         .getElementById("delete-button")
                                                                                                                                                                         .addEventListener("click", deleteSelectedShape);
                                                                                                                                                                         // document.getElementById('show-polygon-tiles').addEventListener('click', showPolygonTiles);
                                                                                                                                                                         // document.getElementById('hide-polygon-tiles').addEventListener('click', hidePolygonTiles);
                                                                                                                                                                         
                                                                                                                                                                         buildColorPalette();
                                                                                                         }
                                                                                                         
                                                                                                         google.maps.Polygon.prototype.my_getBounds = function () {
                                                                                                             var bounds = new google.maps.LatLngBounds();
                                                                                                             this.getPath().forEach(function (element, index) {
                                                                                                                 bounds.extend(element);
                                                                                                             });
                                                                                                             return bounds;
                                                                                                         };
                                                                                                         function addLabelToNewShape(polygon) {
                                                                                                             let text;
                                                                                                             let polygonLabel = prompt(
                                                                                                                                       "Please enter polygon label:",
                                                                                                                                       "Test Label"
                                                                                                                                       );
                                                                                                                                       if (polygonLabel == null || polygonLabel == "") {
                                                                                                                                           text = polygon.my_getBounds().getCenter();
                                                                                                                                       } else {
                                                                                                                                           text = polygonLabel;
                                                                                                                                       }
                                                                                                                                       var labelOptions = {
                                                                                                                                           content: text,
                                                                                                                                           boxStyle: {
                                                                                                                                               textAlign: "center",
                                                                                                                                               fontSize: "15px",
                                                                                                                                               color: "red",
                                                                                                                                               fontWeight: "bold",
                                                                                                                                               backgroundColor: "white",
                                                                                                                                               zIndex: 1000,
                                                                                                                                               // width: "50px"
                                                                                                                                           },
                                                                                                                                           disableAutoPan: true,
                                                                                                                                           pixelOffset: new google.maps.Size(-25, -25),
                                                                                                                                           position: polygon.my_getBounds().getCenter(),
                                                                                                                                           closeBoxURL: "",
                                                                                                                                           isHidden: false,
                                                                                                                                           infoBoxClearance: new google.maps.Size(1, 1),
                                                                                                                                           pane: "floatPane",
                                                                                                                                           enableEventPropagation: true,
                                                                                                                                       };
                                                                                                                                       
                                                                                                                                       polygonOriginalLabel = new InfoBox(labelOptions);
                                                                                                                                       polygon.polygonOriginalLabel = polygonOriginalLabel;
                                                                                                                                       polygon.polygonOriginalLabel.open(map);
                                                                                                         }
                                                                                                         document.addEventListener(
                                                                                                                                   "click",
                                                                                                                                   function (e) {
                                                                                                                                       e = e || window.event;
                                                                                                                                       var target = e.target || e.srcElement,
                                                                                                                                       text = target.textContent || target.innerText;
                                                                                                                                       if (target.classList.contains("infoBox")) {
                                                                                                                                           updateLabelOfPolygon(selectedShape);
                                                                                                                                       }
                                                                                                                                   },
                                                                                                                                   false
                                                                                                                                   );
                                                                                                                                   
                                                                                                                                   function updateLabelOfPolygon(polygon) {
                                                                                                                                       var oldLabel = polygon.polygonOriginalLabel.getContent();
                                                                                                                                       let text;
                                                                                                                                       let polygonLabel = prompt(
                                                                                                                                                                 "Please enter polygon label:",
                                                                                                                                                                 oldLabel
                                                                                                                                                                 );
                                                                                                                                                                 if (polygonLabel == null || polygonLabel == "") {
                                                                                                                                                                     text = polygon.my_getBounds().getCenter();
                                                                                                                                                                 } else {
                                                                                                                                                                     text = polygonLabel;
                                                                                                                                                                     polygon.polygonOriginalLabel.setContent(text);
                                                                                                                                                                 }
                                                                                                                                   }
                }
                                         </script>
        <!--Load the API from the specified URL -- remember to replace YOUR_API_KEY-->
        <script src="https://maps.googleapis.com/maps/api/js?libraries=places,geometry,drawing&key=AIzaSyDvFHiRO5nXWmrXOhY900Z8Sf3CnVhYKD4&callback=initMap"></script>
        
        <ul class="contextmenu">
            <li class="contextmenu-item submenu">
                <a class="contextmenu-link" href="#">Maps</a>
                <ul class="submenu-content">
                    <li>
                        <a class="contextmenu-link" href="#">Satellite</a>
                    </li>
                    <li>
                        <a class="contextmenu-link" href="#">Roadmap</a>
                    </li>
                    <li>
                        <a class="contextmenu-link" href="#">Hybrid</a>
                    </li>
                    <li>
                        <a class="contextmenu-link" href="#">Terrain</a>
                    </li>
                </ul>
            </li>
            <li class="contextmenu-item submenu">
                <a class="contextmenu-link" href="#">Pricing</a>
                <ul class="submenu-content">
                    <li class="contextmenu-item submenu">
                        <a class="contextmenu-link" href="#">Set Country</a>
                        <ul class="submenu-content">
                            <li>
                                <a class="contextmenu-link" href="#">link 1</a>
                            </li>
                            <li>
                                <a class="contextmenu-link" href="#">link 2</a>
                            </li>
                            <li>
                                <a class="contextmenu-link" href="#">link 3</a>
                            </li>
                        </ul>
                    </li>
                    <li class="contextmenu-item submenu">
                        <a class="contextmenu-link" href="#">Yield Curve Model</a>
                        <ul class="submenu-content">
                            <li>
                                <a class="contextmenu-link" href="#">OIS curve</a>
                            </li>
                            <li>
                                <a class="contextmenu-link" href="#">Bond curve</a>
                            </li>
                            <li>
                                <a class="contextmenu-link" href="#">link 3</a>
                            </li>
                        </ul>
                    </li>
                
            </li>
                    
            </li>
        </ul>
        
        <script>
            window.addEventListener("load", function () {
                const contextmenuEl = document.querySelector(".contextmenu");
                document.addEventListener("contextmenu", function (e) {
                    e.preventDefault();
                    contextmenuEl.classList.add("open");
                    contextmenuEl.style.left = e.pageX + "px";
                    contextmenuEl.style.top = e.pageY + "px";
                    return false;
                });
                window.addEventListener("click", function (e) {
                    if (e.target !== contextmenuEl && !contextmenuEl.contains(e.target)) {
                        contextmenuEl.classList.remove("open");
                    }
                });
            });
        </script>
        <script>
            function changeMap()
            {
                var ddl = document.getElementById("dropdownone");
                switch (ddl.selectedIndex)
                {
                    case 1:
                    map.setMapTypeId(google.maps.MapTypeId["SATELLITE"]);
                    break;
                    
                    case 2:
                    map.setMapTypeId(google.maps.MapTypeId["ROADMAP"]);
                    break;
                    
                    case 3:
                    map.setMapTypeId(google.maps.MapTypeId["HYBRID"]);
                    break;
                    
                    case 4:
                    map.setMapTypeId(google.maps.MapTypeId["TERRAIN"]);
                    break;
                }
                
                
            }
        </script>
        <!-- infobox.js -->
        <script type="text/javascript" src="./infobox.js"></script>
    </body>
</html>
